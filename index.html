<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>рднрд╛рд╡реЗрд╢реНрд╡рд░реА рджреВрдз рд╕рдВрд╕реНрдерд╛ ,рдЧреЛрд░рдВрдмреЗ</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body{font-family:'Noto Sans Devanagari',sans-serif;max-width:900px;margin:auto;padding:10px;}
nav a{margin:5px;display:inline-block;text-decoration:none;color:#007bff;}
section{display:none;margin-top:15px;}
section.active{display:block;}
form{background:#f4f4f4;padding:10px;border-radius:5px;margin-top:10px;}
label{display:block;margin-top:5px;}
input,select,button{width:100%;padding:6px;margin-top:2px;box-sizing:border-box;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:0.9rem;}
th,td{border:1px solid #ccc;padding:5px;text-align:center;}
th{background:#eee;}
</style>
</head>
<body>
<h2 style="text-align:center;">ЁЯРД рднрд╛рд╡реЗрд╢реНрд╡рд░реА рджреВрдз рд╕рдВрд╕реНрдерд╛ ,рдЧреЛрд░рдВрдмреЗ</h2>
<nav>
  <a href="#" onclick="show('home')">ЁЯПа рд╣реЛрдо</a>
  <a href="#" onclick="show('collection')">ЁЯеЫ рд╕рдВрдХрд▓рди</a>
  <a href="#" onclick="show('suppliers')">ЁЯУЛ рдкреБрд░рд╡рдард╛рджрд╛рд░</a>
  <a href="#" onclick="show('billing')">ЁЯТ░ рдмрд┐рд▓рд┐рдВрдЧ</a>
  <a href="#" onclick="show('reports')">ЁЯУС рд░рд┐рдкреЛрд░реНрдЯреНрд╕</a>
</nav>

<!-- рд╣реЛрдо -->
<section id="home" class="active">
  <h3>рдбреЗрдЕрд░реА рдорд╛рд╣рд┐рддреА</h3>
  <p>рд╕рдВрдкрд░реНрдХ: 9876543210 / рдЧрд╛рд╡ рдЧреЛрд░рдВрдмреЗ</p>
</section>

<!-- рджреВрдз рд╕рдВрдХрд▓рди -->
<section id="collection">
  <h3>рджреВрдз рд╕рдВрдХрд▓рди рд░реЗрдХреЙрд░реНрдб</h3>
  <form onsubmit="event.preventDefault();saveCollection();">
    <label>рдореЗрдВрдмрд░ рдирдВрдмрд░:</label><input id="memberNo" oninput="autoFillName()" required>
    <label>рдирд╛рд╡:</label><input id="memberName" readonly>
    <label>рддрд╛рд░реАрдЦ:</label><input type="date" id="c_date" required>
    <label>рдкреНрд░рдХрд╛рд░:</label>
    <select id="c_type" required>
      <option value="">рдирд┐рд╡рдбрд╛</option>
      <option value="рдЧрд╛рдп">рдЧрд╛рдп</option>
      <option value="рдореНрд╣реИрд╕">рдореНрд╣реИрд╕</option>
    </select>
    <label>рд▓рд┐рдЯрд░:</label><input type="number" id="c_liter" step="0.1" required>
    <label>рдлреЕрдЯ:</label><input type="number" id="c_fat" step="0.1" required>
    <label>рд░реЗрдЯ:</label><input type="number" id="c_rate" step="0.1" required>
    <button>рд╕реЗрд╡реНрд╣</button>
  </form>
  <table id="collectionTable"><thead>
    <tr><th>рдореЗрдВрдмрд░</th><th>рдирд╛рд╡</th><th>рддрд╛рд░реАрдЦ</th><th>рдкреНрд░рдХрд╛рд░</th><th>рд▓рд┐рдЯрд░</th><th>рдлреЕрдЯ</th><th>рд░реЗрдЯ</th><th>рд░рдХреНрдХрдо</th></tr>
  </thead><tbody id="collectionBody"></tbody></table>
</section>

<!-- рдкреБрд░рд╡рдард╛рджрд╛рд░ -->
<section id="suppliers">
  <h3>рдкреБрд░рд╡рдард╛рджрд╛рд░ рдиреЛрдВрджрдгреА</h3>
  <form onsubmit="event.preventDefault();saveSupplier();">
    <label>рдирд╛рд╡:</label><input id="s_name" required>
    <label>рдореЛрдмрд╛рдИрд▓:</label><input id="s_mobile" required>
    <label>рдЧрд╛рд╡:</label><input id="s_village" required>
    <button>рд╕реЗрд╡реНрд╣</button>
  </form>
  <table><thead><tr><th>рдирд╛рд╡</th><th>рдореЛрдмрд╛рдИрд▓</th><th>рдЧрд╛рд╡</th></tr></thead><tbody id="suppliersBody"></tbody></table>
</section>

<!-- рдмрд┐рд▓рд┐рдВрдЧ -->
<section id="billing">
  <h3>рдкреЗрдореЗрдВрдЯ / рдмрд┐рд▓рд┐рдВрдЧ</h3>
  <p>рдЗрдереЗ Firebase рдордзреНрдпреЗ рдмрд┐рд▓рд┐рдВрдЧ рдбреЗрдЯрд╛ рдареЗрд╡реВрди рдкреНрд░рддреНрдпреЗрдХ рд╢реЗрддрдХрд▒реНрдпрд╛рдЪреА рджреЗрдгреА рджрд╛рдЦрд╡реВ рд╢рдХрддреЛрд╕.</p>
</section>

<!-- рд░рд┐рдкреЛрд░реНрдЯреНрд╕ -->
<section id="reports">
  <h3>рд░рд┐рдкреЛрд░реНрдЯреНрд╕ рдбрд╛рдЙрдирд▓реЛрдб</h3>
  <button onclick="downloadPDF()">PDF рдбрд╛рдЙрдирд▓реЛрдб</button>
  <button onclick="downloadExcel()">Excel рдбрд╛рдЙрдирд▓реЛрдб</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig={/*рддреБрдЭрдВ config*/};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

// sample members
const memberList={101:"рд╕рдВрддреЛрд╖",102:"рд░рд╛рдЬреЗрд╢",103:"рд╕реБрдирд┐рддрд╛",104:"рдЕрдЬрдп"};

window.show=function(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
};

window.autoFillName=function(){
  const no=document.getElementById('memberNo').value;
  document.getElementById('memberName').value=memberList[no]||"";
};

window.saveCollection=function(){
  const no=document.getElementById('memberNo').value;
  const name=document.getElementById('memberName').value;
  const date=document.getElementById('c_date').value;
  const type=document.getElementById('c_type').value;
  const liters=document.getElementById('c_liter').value;
  const fat=document.getElementById('c_fat').value;
  const rate=document.getElementById('c_rate').value;
  const amount=(parseFloat(liters)*parseFloat(rate)).toFixed(2);
  push(ref(db,'milkCollection'),{memberNo:no,name,date,type,liters,fat,rate,amount});
};

onValue(ref(db,'milkCollection'),snap=>{
  const tb=document.getElementById('collectionBody');
  tb.innerHTML='';
  const data=snap.val()||{};
  for(let k in data){
    let r=data[k];
    tb.innerHTML+=`<tr>
    <td>${r.memberNo}</td><td>${r.name}</td><td>${r.date}</td><td>${r.type}</td>
    <td>${r.liters}</td><td>${r.fat}</td><td>${r.rate}</td><td>${r.amount}</td>
    </tr>`;
  }
});

window.saveSupplier=function(){
  const name=document.getElementById('s_name').value;
  const mobile=document.getElementById('s_mobile').value;
  const village=document.getElementById('s_village').value;
  push(ref(db,'suppliers'),{name,mobile,village});
  document.getElementById('s_name').value='';
  document.getElementById('s_mobile').value='';
  document.getElementById('s_village').value='';
};

onValue(ref(db,'suppliers'),snap=>{
  const tb=document.getElementById('suppliersBody');
  tb.innerHTML='';
  const data=snap.val()||{};
  for(let k in data){
    let r=data[k];
    tb.innerHTML+=`<tr><td>${r.name}</td><td>${r.mobile}</td><td>${r.village}</td></tr>`;
  }
});

// PDF/Excel
window.downloadPDF=function(){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  doc.setFontSize(14);
  doc.text('рджреВрдз рд╕рдВрдХрд▓рди рд░реЗрдХреЙрд░реНрдб',14,15);
  doc.autoTable({html:'#collectionTable',startY:25});
  doc.save('рджреВрдз-рд╕рдВрдХрд▓рди.pdf');
};

window.downloadExcel=function(){
  let wb=XLSX.utils.table_to_book(document.getElementById('collectionTable'),{sheet:"Sheet1"});
  XLSX.writeFile(wb,"рджреВрдз-рд╕рдВрдХрд▓рди.xlsx");
};
</script>
</body>
</html>
