<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>рджреВрдз рд╕рдВрд╕реНрдерд╛ рдкреЛрд░реНрдЯрд▓</title>
  <style>
    body{font-family:'Noto Sans Devanagari',sans-serif;max-width:900px;margin:auto;}
    nav a{margin:5px;padding:5px 10px;display:inline-block;background:#eee;text-decoration:none;}
    section{display:none;}
    section.active{display:block;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{border:1px solid #ccc;padding:5px;text-align:center;}
  </style>
</head>
<body>
  <h2 style="text-align:center;">ЁЯРД рднрд╛рд╡реЗрд╢реНрд╡рд░реА рджреВрдз рд╕рдВрд╕реНрдерд╛ рдкреЛрд░реНрдЯрд▓</h2>
  <nav>
    <a href="#" onclick="showPage('home')">ЁЯПа рд╣реЛрдо</a>
    <a href="#" onclick="showPage('collection')">ЁЯУЭ рджреВрдз рд╕рдВрдХрд▓рди</a>
    <a href="#" onclick="showPage('suppliers')">ЁЯСд рдкреБрд░рд╡рдард╛рджрд╛рд░</a>
    <a href="#" onclick="showPage('billing')">ЁЯТ░ рдкреЗрдореЗрдВрдЯ/рдмрд┐рд▓рд┐рдВрдЧ</a>
    <a href="#" onclick="showPage('reports')">ЁЯУД рд░рд┐рдкреЛрд░реНрдЯреНрд╕</a>
  </nav>

  <!-- рд╣реЛрдо -->
  <section id="home" class="active">
    <h3>рднрд╛рд╡реЗрд╢реНрд╡рд░реА рджреВрдз рд╕рдВрд╕реНрдерд╛ ,рдЧреЛрд░рдВрдмреЗ</h3>
    <p>рд╕рдВрдкрд░реНрдХ: репреоренремрелрекрейреирезреж</p>
    <p>рд╕рдВрд╕реНрдереЗрдЪреА рдорд╛рд╣рд┐рддреА рдЗрдереЗ рдЯрд╛рдХрд╛тАж</p>
  </section>

  <!-- рджреВрдз рд╕рдВрдХрд▓рди -->
  <section id="collection">
    <h3>рджреВрдз рд╕рдВрдХрд▓рди рд░реЗрдХреЙрд░реНрдб</h3>
    <form onsubmit="event.preventDefault();saveCollection();">
      рддрд╛рд░реАрдЦ:<input type="date" id="c_date" required>
      рд▓рд┐рдЯрд░:<input type="number" id="c_liter" required>
      рдлреЕрдЯ:<input type="number" id="c_fat" step="0.1" required>
      рд░рдХреНрдХрдо:<input type="number" id="c_amount" required>
      <button type="submit">рд╕реЗрд╡реНрд╣</button>
    </form>
    <table>
      <thead><tr><th>рддрд╛рд░реАрдЦ</th><th>рд▓рд┐рдЯрд░</th><th>рдлреЕрдЯ</th><th>рд░рдХреНрдХрдо</th></tr></thead>
      <tbody id="collectionBody"></tbody>
    </table>
  </section>

  <!-- рдкреБрд░рд╡рдард╛рджрд╛рд░ -->
  <section id="suppliers">
    <h3>рдкреБрд░рд╡рдард╛рджрд╛рд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди</h3>
    <form onsubmit="event.preventDefault();saveSupplier();">
      рдирд╛рд╡:<input type="text" id="s_name" required>
      рдореЛрдмрд╛рдИрд▓:<input type="text" id="s_mobile" required>
      рдЧрд╛рд╡:<input type="text" id="s_village" required>
      <button type="submit">рд╕реЗрд╡реНрд╣</button>
    </form>
    <table>
      <thead><tr><th>рдирд╛рд╡</th><th>рдореЛрдмрд╛рдИрд▓</th><th>рдЧрд╛рд╡</th></tr></thead>
      <tbody id="supplierBody"></tbody>
    </table>
  </section>

  <!-- рдмрд┐рд▓рд┐рдВрдЧ -->
  <section id="billing">
    <h3>рдкреЗрдореЗрдВрдЯ/рдмрд┐рд▓рд┐рдВрдЧ</h3>
    <p>рдЗрдереЗ рдкреНрд░рддреНрдпреЗрдХ рд╢реЗрддрдХрд▒реНрдпрд╛рдЪреА рджреЗрдгреА / рдЙрдзрд╛рд░реА рджрд╛рдЦрд╡рд╛. (рдбреЗрдЯрд╛ Firebase рдордзреВрди рдЖрдгреВрди рдЧрдгрдирд╛ рдХрд░реВ рд╢рдХрддреЛ)</p>
  </section>

  <!-- рд░рд┐рдкреЛрд░реНрдЯреНрд╕ -->
  <section id="reports">
    <h3>рд░рд┐рдкреЛрд░реНрдЯреНрд╕ рдбрд╛рдЙрдирд▓реЛрдб</h3>
    <button onclick="downloadPDF('collectionTable','milk-collection.pdf')">рджреВрдз рд╕рдВрдХрд▓рди PDF</button>
    <button onclick="downloadSuppliers()">рдкреБрд░рд╡рдард╛рджрд╛рд░ PDF</button>
  </section>

  <!-- jsPDF + autoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <!-- Firebase v9 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_4wQmuzFPJjid-Co9Y-6vgEb70jxWTSY",
      authDomain: "dairy-mill-production.firebaseapp.com",
      databaseURL: "https://dairy-mill-production-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "dairy-mill-production",
      storageBucket: "dairy-mill-production.firebasestorage.app",
      messagingSenderId: "721651192386",
      appId: "1:721651192386:web:b5613cedce06deed1e13db"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // рдкреЗрдЬ рд╕реНрд╡рд┐рдЪ
    window.showPage=function(id){
      document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // рджреВрдз рд╕рдВрдХрд▓рди рд╕реЗрд╡реНрд╣
    window.saveCollection=function(){
      push(ref(db,'milkCollection'),{
        date:document.getElementById('c_date').value,
        liter:document.getElementById('c_liter').value,
        fat:document.getElementById('c_fat').value,
        amount:document.getElementById('c_amount').value
      }).then(()=>alert('рд╕реЗрд╡реНрд╣ рдЭрд╛рд▓рдВ'));
    }

    // рдкреБрд░рд╡рдард╛рджрд╛рд░ рд╕реЗрд╡реНрд╣
    window.saveSupplier=function(){
      push(ref(db,'suppliers'),{
        name:document.getElementById('s_name').value,
        mobile:document.getElementById('s_mobile').value,
        village:document.getElementById('s_village').value
      }).then(()=>alert('рд╕реЗрд╡реНрд╣ рдЭрд╛рд▓рдВ'));
    }

    // рдбреЗрдЯрд╛ рд╡рд╛рдЪрдгреЗ
    onValue(ref(db,'milkCollection'),snap=>{
      const tb=document.getElementById('collectionBody');
      tb.innerHTML='';
      const data=snap.val();
      for(let k in data){
        let r=data[k];
        tb.innerHTML+=`<tr><td>${r.date}</td><td>${r.liter}</td><td>${r.fat}</td><td>${r.amount}</td></tr>`;
      }
    });

    onValue(ref(db,'suppliers'),snap=>{
      const tb=document.getElementById('supplierBody');
      tb.innerHTML='';
      const data=snap.val();
      for(let k in data){
        let r=data[k];
        tb.innerHTML+=`<tr><td>${r.name}</td><td>${r.mobile}</td><td>${r.village}</td></tr>`;
      }
    });

    // PDF Download (milkCollection)
    window.downloadPDF=function(selector,name){
      const { jsPDF }=window.jspdf;
      const doc=new jsPDF();
      doc.text('рджреВрдз рд╕рдВрдХрд▓рди рд░рд┐рдкреЛрд░реНрдЯ',14,15);
      doc.autoTable({html:'#collection table',startY:25});
      doc.save(name);
    }

    // Suppliers PDF
    window.downloadSuppliers=function(){
      const { jsPDF }=window.jspdf;
      const doc=new jsPDF();
      doc.text('рдкреБрд░рд╡рдард╛рджрд╛рд░ рд░рд┐рдкреЛрд░реНрдЯ',14,15);
      doc.autoTable({html:'#suppliers table',startY:25});
      doc.save('suppliers.pdf');
    }
  </script>
</body>
</html>
